<style>
    fieldset {
        margin: 20px;
        border-radius: 5px;
        border: 1px solid #3465a4;
        padding: 20px;
    }

    legend {
        font-size: 18px;
        font-weight: normal;
        color: #3465a4;
    }

    div.field {
        font-weight: normal;
        display: inline-block;
        margin: 10px;
        color: #000;
    }

    select {
        min-width: 100%;
    }

    /*input {
        min-width: 100%;
    }*/
</style>

<%= form_for :person do |f| %>

    <fieldset>
      <legend><font size='5' style='border: 2px;'>Details of Child</font></legend>

      <%= f.hidden_field :_rev rescue "" %>


       <%= f.hidden_field :place_of_birth %> <!--@person[:place_of_birth] -->
       <%= f.hidden_field :birth_location_id %> <!--hospital_of_birth -->
       <!-- %= f.hidden_field :birth_address  %> <!--birth_address -->
       <!-- %= f.hidden_field :birth_district %> <!--birth_district -->
       <!-- %= f.hidden_field :birth_ta  %> <!--birth_ta -->
       <!-- %= f.hidden_field :birth_village  %> <!--birth_village -->
       <!-- %= f.hidden_field :other_birth_place_details  %> <!--other_birth_place_details -->
       <%= f.hidden_field :parents_married_to_each_other  %> <!--@person[:parents_married_to_each_other] -->
       <%= f.hidden_field :date_of_marriage %> <!--date_of_marriage -->
       <%= f.hidden_field :court_order_attached  %> <!--person_court_order_attached -->
       <!-- %= f.hidden_field :parents_signed  % -->
       <%= f.hidden_field :acknowledgement_of_receipt_date %> <!--person_parents_signed -->
       <%= f.hidden_field :type_of_birth %>
       <!-- %= f.hidden_field :multiple_birth_id %-->
       <input type="hidden" name="registration_type" id="registration_type" />

       <input id="person_relationship" name="child[relationship]" value="normal" type="hidden"/>
      
       <input name="relationship" value="normal" type="hidden"/>
      

       <input type="hidden" id="person_mother_last_name" name="child[mother][last_name]" value="<%= @person[:mother][:last_name] rescue nil %>" />
       <input type="hidden" id="person_mother_first_name"  name="child[mother][first_name]" value="<%= @person[:mother][:first_name] rescue nil %>" />
       <input type="hidden" id="person_mother_middle_name"  name="child[mother][middle_name]" value="<%= @person[:mother][:middle_name] rescue nil %>" />
       <input type="hidden" id="person_mother_id_number" name="child[mother][id_number]" value="<%= @person[:mother][:id_number] rescue nil %>" />

       <input type="hidden" id="person_mother_birthdate" name="child[mother][birthdate]" value="<%= @person[:mother][:birthdate] rescue nil %>" />
       <input type="hidden" id="person_mother_birthdate_estimated" name="child[mother][birthdate_estimated]" value="<%= @person[:mother][:birthdate_estimated] rescue nil %>" />
       <input type="hidden" id="person_mother_citizenship" name="child[mother][citizenship]" value="<%= @person[:mother][:citizenship] rescue nil %>" />
       <input type="hidden" id="person_mother_current_district" name="child[mother][current_district]" value="<%= @person[:mother][:current_district] rescue nil %>" />
       <input type="hidden" id="person_mother_current_ta" name="child[mother][current_ta]" value="<%= @person[:mother][:current_ta] rescue nil %>" />
       <input type="hidden" id="person_mother_current_village" name="child[mother][current_village]" value="<%= @person[:mother][:current_village] rescue nil %>" />
       <input type="hidden" id="person_mother_residential_country" name="child[mother][residential_country]" value="<%= @person[:mother][:residential_country] rescue nil %>" />

       <input type="hidden" id="person_mother_home_district" name="child[mother][home_district]" value="<%= @person[:mother][:home_district] rescue nil %>" />
       <input type="hidden" id="person_mother_home_ta" name="child[mother][home_ta]" value="<%= @person[:mother][:home_ta] rescue nil %>" />
       <input type="hidden" id="person_mother_home_village" name="child[mother][home_village]" value="<%= @person[:mother][:home_village] rescue nil %>" />



       <%= f.hidden_field :gestation_at_birth  %>
       <%= f.hidden_field :number_of_prenatal_visits %>
       <%= f.hidden_field :month_prenatal_care_started %>

       <%#= f.hidden_field :mode_of_delivery  %> <!--@person[:mode_of_delivery] -->
       <%= f.hidden_field :number_of_children_born_alive_inclusive %>
       <%= f.hidden_field :number_of_children_born_still_alive %>

       <%= f.hidden_field :level_of_education  %> <!-- @person[:level_of_education] -->

       <input type="hidden" id="person_father_last_name"  name="child[father][last_name]" value="<%= @person[:father][:last_name] rescue nil %>" />
       <input type="hidden" id="person_father_first_name"  name="child[father][first_name]" value="<%= @person[:father][:first_name] rescue nil %>" />
       <input type="hidden" id="person_father_middle_name"  name="child[father][middle_name]" value="<%= @person[:father][:middle_name] rescue nil %>" />
       <input type="hidden" id="person_father_id_number" name="child[father][id_number]" value="<%= @person[:father][:id_number] rescue nil %>" />

       <input type="hidden" id="person_father_birthdate" name="child[father][birthdate]" value="<%= @person[:father][:birthdate] rescue nil %>" />
       <input type="hidden" id="person_father_birthdate_estimated" name="child[father][birthdate_estimated]" value="<%= @person[:father][:birthdate_estimated] rescue nil %>" />
       <input type="hidden" id="person_father_citizenship" name="child[father][citizenship]" value="<%= @person[:father][:citizenship] rescue nil %>" />
       <input type="hidden" id="person_father_current_district" name="child[father][current_district]" value="<%= @person[:father][:current_district] rescue nil %>" />
       <input type="hidden" id="person_father_current_ta" name="child[father][current_ta]" value="<%= @person[:father][:current_ta] rescue nil %>" />
       <input type="hidden" id="person_father_current_village" name="child[father][current_village]" value="<%= @person[:father][:current_village] rescue nil %>" />
       <input type="hidden" id="person_father_residential_country" name="child[father][residential_country]" value="<%= @person[:father][:residential_country] rescue nil %>" />

       <input type="hidden" id="person_father_home_district" name="child[father][home_district]" value="<%= @person[:father][:home_district] rescue nil %>" />
       <input type="hidden" id="person_father_home_ta" name="child[father][home_ta]" value="<%= @person[:father][:home_ta] rescue nil %>" />
       <input type="hidden" id="person_father_home_village" name="child[father][home_village]" value="<%= @person[:father][:home_village] rescue nil %>" />

       <input type="hidden" id="person_informant_last_name" name="child[informant][last_name]" value="<%= @person[:informant][:last_name] rescue nil %>" />
       <input type="hidden" id="person_informant_first_name" name="child[informant][first_name]" value="<%= @person[:informant][:first_name] rescue nil %>" />
       <input type="hidden" id="person_informant_middle_name" name="child[informant][middle_name]" value="<%= @person[:informant][:middle_name] rescue nil %>" />
       <input type="hidden" id="person_informant_id_number" name="child[informant][id_number]" value="<%= @person[:informant][:id_number] rescue nil %>" />

       <input type="hidden" id="person_informant_relationship_to_child" name="child[informant][relationship_to_child]" value="<%= @person[:informant][:relationship_to_child] rescue nil %>" />

       <input type="hidden" id="person_informant_current_district" name="child[informant][current_district]" value="<%= @person[:informant][:current_district] rescue nil %>" />

       <input type="hidden" id="person_informant_current_ta" name="child[informant][current_ta]" value="<%= @person[:informant][:current_ta] rescue nil %>" />

       <input type="hidden" id="person_informant_current_village" name="child[informant][current_village]" value="<%= @person[:informant][:current_village] rescue nil %>" />
       <input type="hidden" id="person_informant_addressline1 " name="child[informant][addressline1 ]" value="<%= @person[:informant][:addressline1] rescue nil %>" />
       <input type="hidden" id="person_informant_addressline2" name="child[informant][addressline2]" value="<%= @person[:informant][:addressline2] rescue nil %>" />
       <input type="hidden" id="person_informant_city" name="child[informant][city]" value="<%= @person[:informant][:city] rescue nil %>" />
       <input type="hidden" id="person_informant_phone_number" name="child[informant][phone_number]" value="<%= @person[:informant][:phone_number] rescue nil %>" />

       <!-- %= f.hidden_field :record_status  % -->
       <!-- %= f.hidden_field :form_signed  % --> <!-- @person[:form_signed] -->

      <div class="field">
        <label for="person_last_name">Surname</label>
        <br>
        <%= (f.text_field :last_name, :ajaxURL => "/get_last_names", :class => "input_cell") rescue "" %>
      </div>
      <div class="field">
        <%= f.label :first_name %>
        <br>
        <%= (f.text_field :first_name, :ajaxURL => "/get_first_names",  :class => "input_cell", :tt_onUnload => "updateRegistrationType()") rescue "" %>
      </div>
      <div class="field">
        <label for="person_middle_name">Other Names</label>
        <br>
        <%= (f.text_field :middle_name, :ajaxURL => "/get_first_names", :class => "input_cell", :optional => :true) rescue "" %>
      </div>

    </fieldset>

    <fieldset>
      <legend><font size='5' style='border: 2px;'>Details of Child continued..</font></legend>

      <div class="field">
        <label for="person_birthdate">Date of Birth</label>
        <br>
        <%= (f.text_field :birthdate, :class => "input_cell", :fieldtype => "date",
                          :absolute_min => @person.birthdate.to_date.advance(:days => -2).strftime('%Y/%m/%d'),
                          :absolute_max => @person.birthdate.to_date.advance(:days => 2).strftime('%Y/%m/%d')) rescue "" %>
        <%= f.hidden_field :birthdate_estimated rescue "" %>
      </div>
      <div class="field">
        <label for="person_gender">Sex</label><br>
        <select id="person_gender" name="child[gender]" class="input_cell">
          <option></option>
          <option <%= ((@person[:gender] rescue nil) == "Female" ? "selected" : "") %> >Female</option>
          <option <%= ((@person[:gender] rescue nil) == "Male" ? "selected" : "") %> >Male</option>
        </select>
      </div>

      <div class="field">
        <label for="person_birth_weight">Birth weight (in Kilogrammes)</label>
        <br>
        <% if @prev_person_weight.present? %>
            <%= (f.text_field :birth_weight,
            									:value => "",
            									:placeholder => "0.000",
            									:class => "input_cell",
            									:fieldtype => "decimal",
            									:regex => '^\d+\.\d{3}$',
            									:regex_message => "Expecting baby weight to have 3 decimal places.\nAppend zero(s) or truncate the weight for you?",
            									:absolute_min => 0.7 ,
            									:absolute_max => 6,
        			 								:min => 2.5,
        			 								:max => 4 ) %>
        <% else %>
        			 <%= (f.text_field :birth_weight,
        			 									 :value => "",
        			 									 :placeholder => "0.000",
        			 									 :class => "input_cell",
        			 									 :fieldtype => "decimal",
        			 									 :regex => '^\d+\.\d{3}$',
        			 									 :regex_message => "Expecting baby weight to have 3 decimal places.\nAppend zero(s) truncate the weight for you?",
        			 									 :absolute_min => 0.7 ,
        			 									 :absolute_max => 6,
        			 									 :min => 2.5,
        			 									 :max => 4,
        			 									 :optional => :true) %>

        <% end %>
      </div>

      <div class="field">
        <%= f.label :mode_of_delivery %>
        <br>
        <select id="person_mode_of_delivery" name="child[mode_of_delivery]" class="input_cell" optional="true">
          <option></option>
          <option <%= ((@person[:mode_of_delivery] rescue nil) == "SVD" ? "selected" : "") %> >SVD</option>
          <option <%= ((@person[:mode_of_delivery] rescue nil) == "Vacuum Extraction" ? "selected" : "") %> >Vacuum Extraction</option>
          <option <%= ((@person[:mode_of_delivery] rescue nil) == "Breech" ? "selected" : "") %> >Breech</option>
          <option <%= ((@person[:mode_of_delivery] rescue nil) == "Forceps" ? "selected" : "") %> >Forceps</option>
          <option <%= ((@person[:mode_of_delivery] rescue nil) == "Caesarean Section" ? "selected" : "") %> >Caesarean Section</option>
        </select>
      </div>

      <!--div class="field">
        <%= f.label :type_of_birth %>
        <br>
        <select id="person_type_of_birth" name="child[type_of_birth]" class="input_cell" optional="true" >
          <option></option>
          <option <%= ((@person[:type_of_birth] rescue nil) == "Single" ? "selected" : "") %> >Single</option>

          <option <%= ((@person[:type_of_birth] rescue nil) == "Twin" ? "selected" : "") %> >Twin</option>
          <option <%= ((@person[:type_of_birth] rescue nil) == "Second Twin" ? "selected" : "") %> >Second Twin</option>

          <option <%= ((@person[:type_of_birth] rescue nil) == "Triplet" ? "selected" : "") %> >First Triplet</option>
          <option <%= ((@person[:type_of_birth] rescue nil) == "Second Triplet" ? "selected" : "") %> >Second Triplet</option>
          <option <%= ((@person[:type_of_birth] rescue nil) == "Third Triplet" ? "selected" : "") %> >Third Triplet</option>

          <option <%= ((@person[:type_of_birth] rescue nil) == "Other" ? "selected" : "") %> >Other</option>
        </select>
      </div>
      <div class="field">
        <label for="person_other_type_of_birth">Specify Other Type of Birth</label>
        <br>
        <%= (f.text_field :other_type_of_birth, :class => "input_cell", :condition => "__$('person_type_of_birth').value.trim() == 'Other'", :optional => :true ) rescue "" %>
      </div-->

    </fieldset>


    <div class="actions">
      <%= f.submit :id => "btnAction", :class => "buttons blue", :style => "position: absolute; right: 160px; bottom: 20px;" %>
    </div>
<% end %>

<script>

    function copyMothersResidence() {

        if (__$("person_father_current_district") && __$("person_mother_current_district") && __$("textForperson_father_current_district")) {

            __$("person_father_current_district").value = __$("person_mother_current_district").value;

            __$("textForperson_father_current_district").value = __$("person_mother_current_district").value;

        }

        if (__$("person_father_current_ta") && __$("person_mother_current_ta") && __$("textForperson_father_current_ta")) {

            __$("person_father_current_ta").value = __$("person_mother_current_ta").value;

            __$("textForperson_father_current_ta").value = __$("person_mother_current_ta").value;

        }

        if (__$("person_father_current_village") && __$("person_mother_current_village") && __$("textForperson_father_current_village")) {

            __$("person_father_current_village").value = __$("person_mother_current_village").value;

            __$("textForperson_father_current_village").value = __$("person_mother_current_village").value;

        }

    }

    function deleteFathersResidence() {

        if (__$("person_father_current_district") && __$("textForperson_father_current_district")) {

            __$("person_father_current_district").value = "";

            __$("textForperson_father_current_district").value = "";

        }

        if (__$("person_father_current_ta") && __$("textForperson_father_current_ta")) {

            __$("person_father_current_ta").value = "";

            __$("textForperson_father_current_ta").value = "";

        }

        if (__$("person_father_current_village") && __$("textForperson_father_current_village")) {

            __$("person_father_current_village").value = "";

            __$("textForperson_father_current_village").value = "";

        }

    }

    function loadMothersDetails(){

        if (__$("person_mother_first_name") && __$("person_informant_first_name") && __$("textForperson_informant_first_name")) {

            __$("person_informant_first_name").value = __$("person_mother_first_name").value;

            __$("textForperson_informant_first_name").value = __$("person_mother_first_name").value;

        }

        if (__$("person_mother_middle_name") && __$("person_informant_middle_name") && __$("textForperson_informant_middle_name")) {

            __$("person_informant_middle_name").value = __$("person_mother_middle_name").value;

            __$("textForperson_informant_middle_name").value = __$("person_mother_middle_name").value;

        }

        if (__$("person_mother_last_name") && __$("person_informant_last_name") && __$("textForperson_informant_last_name")) {

            __$("person_informant_last_name").value = __$("person_mother_last_name").value;

            __$("textForperson_informant_last_name").value = __$("person_mother_last_name").value;

        }

        if (__$("person_informant_relationship_to_child") && __$("textForperson_informant_relationship_to_child")) {

            __$("person_informant_relationship_to_child").value = "Mother";

            __$("textForperson_informant_relationship_to_child").value = "Mother";

        }

        if (__$("person_mother_current_district") && __$("person_informant_current_district")) {

            __$("person_informant_current_district").value = __$("person_mother_current_district").value;

        }

        if (__$("person_mother_current_ta") && __$("person_informant_current_ta")) {

            __$("person_informant_current_ta").value = __$("person_mother_current_ta").value;

        }

        if (__$("person_mother_current_village") && __$("person_informant_current_village")) {

            __$("person_informant_current_village").value = __$("person_mother_current_village").value;

        }

        if (__$("person_mother_id_number")) {

            __$("person_informant_id_number").value = __$("person_mother_id_number").value;

            __$("textForperson_informant_id_number").value = __$("person_mother_id_number").value;


        }

    }

    function unloadMothersDetails(){

        if (__$("person_informant_first_name") && __$("textForperson_informant_first_name")) {

            __$("person_informant_first_name").value = "";

            __$("textForperson_informant_first_name").value = "";

        }

        if (__$("person_informant_middle_name") && __$("textForperson_informant_middle_name")) {

            __$("person_informant_middle_name").value = "";

            __$("textForperson_informant_middle_name").value = "";

        }

        if (__$("person_informant_last_name") && __$("textForperson_informant_last_name")) {

            __$("person_informant_last_name").value = "";

            __$("textForperson_informant_last_name").value = "";

        }

        if (__$("person_informant_relationship_to_child") && __$("textForperson_informant_relationship_to_child")) {

            __$("person_informant_relationship_to_child").value = "";

            __$("textForperson_informant_relationship_to_child").value = "";

        }

        if (__$("person_informant_current_district") && __$("textForperson_informant_current_district")) {

            __$("person_informant_current_district").value = "";

            __$("textForperson_informant_current_district").value = "";

        }

        if (__$("person_informant_current_ta") && __$("textForperson_informant_current_ta")) {

            __$("person_informant_current_ta").value = "";

            __$("textForperson_informant_current_ta").value = "";

        }

        if (__$("person_informant_current_village") && __$("textForperson_informant_current_village")) {

            __$("person_informant_current_village").value = "";

            __$("textForperson_informant_current_village").value = "";

        }

        if(__$("person_informant_id_number") && __$("textForperson_informant_id_number")) {

             __$("person_informant_id_number").value = "";

            __$("textForperson_informant_id_number").value = "";
        }


    }

    init();

    summaryHash = {
                    "Child Name" : ["person_first_name","person_middle_name","person_last_name"],
                    "Child Gender" : ["person_gender"],
                    "Child Date of Birth" : ["person_birthdate"],
                    "Place of Birth" : ((__$('person_place_of_birth').value.trim().toLowerCase() == 'hospital') ? ["person_hospital_of_birth"] : ["person_place_of_birth"]),
                    "Mother " : ["person_mother_first_name", "person_mother_middle_name", "person_mother_last_name"],
                    "Father" : ["person_father_first_name", "person_father_middle_name","person_father_last_name"],
                    "Parents Married to each Other?": ['person_parents_married_to_each_other'],
                    "Court order attached?": ['person_court_order_attached'],
                    "Parents signed?" : ["person_parents_signed"],
                    "Form Signed by Informant?" : ["person_form_signed"],
                    "Delayed Registration" : ['registration_type']
                   };

  function updateRegistrationType()
    {

        var person_dob = __$('person_birthdate').value;

        var dob = person_dob.split('/');

        if (person_dob.match(/\W?/i)) {
            if (dob[1] == '?') {
                dob[0] = "1";
                dob[1] = "07";
            }
            else if (dob[0] == '?') {
                dob[1] = parseInt(monthNames[dob[1]]);
                dob[0] = "15"
            }
        }
        else {
            dob[1] = parseInt(monthNames[dob[1]]);
            dob[1] = dob[1] + 1

            if (dob[1] < 10){
                dob[1] = "0" + dob[1];
            }
        }

        if (((Date.parse(__$('person_acknowledgement_of_receipt_date').value) - Date.parse((dob[0] + "/" + dob[1] + "/" + dob[2])))/ (1000 * 60 * 60 * 24)) > 42)
        {
            __$('registration_type').value = 'Yes'
        }
        else
        {
            __$('registration_type').value = 'No'
        }

    }

  showMessage();

		function  showMessage() {

				<% if @person.errors.any?
          errors = []
          errors << "<p>" + pluralize(@person.errors.count, "error") + " occured while saving this record:</p>"
           @person.errors.full_messages.each do |message|
             errors << "<li>" + message + "</li>"
          end %>

           showMsg('<%= errors.join.html_safe %>', true);

        <% end %>

     }


</script>
